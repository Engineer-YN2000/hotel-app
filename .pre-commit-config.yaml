# pre-commit フレームワーク (https://pre-commit.com/) の設定
repos:
  # ---------------------------------------------------
  # 1. 基本的な整形フック (pre-commit 標準)
  # ---------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace # 行末の不要なスペースを削除
      - id: end-of-file-fixer   # ファイル末尾の改行を修正
      - id: check-yaml          # YAML ファイルの構文チェック
      - id: check-json          # JSON ファイルの構文チェック

  # ---------------------------------------------------
  # 2. Prettier (フォーマッター)
  #    ローカル (frontend/) の npm スクリプト ('npm run format') を実行
  # ---------------------------------------------------
  - repo: local
    hooks:
      - id: prettier-format
        name: prettier-format
        language: system
        # frontend 直下で実行し、渡されたパスから 'frontend/' を取り除いた上で npx prettier を実行
        entry: bash
        args:
          - -lc
          - |
            set -e
            cd frontend
            files=()
            for f in "$@"; do files+=("${f#frontend/}"); done
            if [ "${#files[@]}" -eq 0 ]; then
              npx --yes prettier@^3.3.3 --write "src/**/*.{js,jsx,css,json}"
            else
              npx --yes prettier@^3.3.3 --write "${files[@]}"
            fi
        files: ^frontend/src/.*\.(js|jsx|css|json)$
        pass_filenames: true

  # ---------------------------------------------------
  # 3. ESLint (リンター)
  #    ローカル (frontend/) の npm スクリプト ('npm run lint:fix') を実行
  # ---------------------------------------------------
  - repo: local
    hooks:
      - id: eslint-lint-fix
        name: eslint-lint-fix
        language: system
        # frontend 直下で実行し、渡されたパスから 'frontend/' を取り除いて ESLint に渡す
        entry: bash
        args:
          - -lc
          - |
            set -e
            cd frontend
            files=()
            for f in "$@"; do files+=("${f#frontend/}"); done
            if [ "${#files[@]}" -eq 0 ]; then
              npm run -s lint:fix -- "src/**/*.{js,jsx}"
            else
              npm run -s lint:fix -- "${files[@]}"
            fi
        files: ^frontend/src/.*\.(js|jsx)$
        pass_filenames: true

  # ---------------------------------------------------
  # 4. Java フォーマッター (Spotless)
  #    'mvn spotless:apply' を実行
  # ---------------------------------------------------
  - repo: local
    hooks:
      - id: java-spotless-format
        name: java-spotless-format
        language: system
        # pom.xml で定義した spotless プラグインを実行
        entry: mvn
        args: ["--file", "backend/pom.xml", "checkstyle:check"]
        files: ^backend/src/main/java/.*\.(java)$
        pass_filenames: false

  # ---------------------------------------------------
  # 5. Java リンター (Checkstyle)
  #    'mvn checkstyle:check' を実行
  # ---------------------------------------------------
  - repo: local
    hooks:
      - id: java-checkstyle-lint
        name: java-checkstyle-lint
        language: system
        # pom.xml で定義した checkstyle プラグインを実行
        entry: mvn
        args: ["--file", "backend/pom.xml", "checkstyle:check"]
        files: ^backend/src/main/java/.*\.(java)$
        pass_filenames: false
